<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ThreeJs | Yongqi Zhang</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/x-icon" href="/documentation/favicon.ico">
    <meta name="description" content="Portfolio">
    
    <link rel="preload" href="/documentation/assets/css/0.styles.01e2ef8d.css" as="style"><link rel="preload" href="/documentation/assets/js/app.278a8878.js" as="script"><link rel="preload" href="/documentation/assets/js/2.02551ac5.js" as="script"><link rel="preload" href="/documentation/assets/js/26.ae923d6f.js" as="script"><link rel="prefetch" href="/documentation/assets/js/10.3044f083.js"><link rel="prefetch" href="/documentation/assets/js/11.74119b45.js"><link rel="prefetch" href="/documentation/assets/js/12.5d14dc05.js"><link rel="prefetch" href="/documentation/assets/js/13.c067434f.js"><link rel="prefetch" href="/documentation/assets/js/14.29d43c1c.js"><link rel="prefetch" href="/documentation/assets/js/15.cb200470.js"><link rel="prefetch" href="/documentation/assets/js/16.33b9b6f8.js"><link rel="prefetch" href="/documentation/assets/js/17.88d0f2e8.js"><link rel="prefetch" href="/documentation/assets/js/18.8769baf6.js"><link rel="prefetch" href="/documentation/assets/js/19.dd8d5073.js"><link rel="prefetch" href="/documentation/assets/js/20.b03ad151.js"><link rel="prefetch" href="/documentation/assets/js/21.edc0c165.js"><link rel="prefetch" href="/documentation/assets/js/22.bfe9ae4f.js"><link rel="prefetch" href="/documentation/assets/js/23.8f633e0b.js"><link rel="prefetch" href="/documentation/assets/js/24.5f1e1d16.js"><link rel="prefetch" href="/documentation/assets/js/25.372cebbe.js"><link rel="prefetch" href="/documentation/assets/js/27.67079f88.js"><link rel="prefetch" href="/documentation/assets/js/28.aafadf07.js"><link rel="prefetch" href="/documentation/assets/js/3.3ac6f192.js"><link rel="prefetch" href="/documentation/assets/js/4.b41a279e.js"><link rel="prefetch" href="/documentation/assets/js/5.01663043.js"><link rel="prefetch" href="/documentation/assets/js/6.26cc58b6.js"><link rel="prefetch" href="/documentation/assets/js/7.9fccae43.js"><link rel="prefetch" href="/documentation/assets/js/8.f08b3546.js"><link rel="prefetch" href="/documentation/assets/js/9.69af4419.js">
    <link rel="stylesheet" href="/documentation/assets/css/0.styles.01e2ef8d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/documentation/" class="home-link router-link-active"><!----> <span class="site-name">Yongqi Zhang</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.yongqi.ml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.yongqi.ml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/documentation/Hundfutter/1_Hund-Projektbeschreibung.html" class="sidebar-link">Hundfutter Web Shop</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hundfutter Detaillierte Entwicklung</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/documentation/ThreeD/1_3D.html" class="sidebar-link">3D Web</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>3D Web Detaillierte Entwicklung</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/documentation/ThreeD/01._Blender.html" class="sidebar-link">Blender</a></li><li><a href="/documentation/ThreeD/02._ThreeJs.html" aria-current="page" class="active sidebar-link">ThreeJs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/ThreeD/02._ThreeJs.html#mainthreescene-js" class="sidebar-link">MainThreeScene.js</a></li><li class="sidebar-sub-header"><a href="/documentation/ThreeD/02._ThreeJs.html#floor-js" class="sidebar-link">Floor.js</a></li><li class="sidebar-sub-header"><a href="/documentation/ThreeD/02._ThreeJs.html#camparallax-js" class="sidebar-link">CamParallax.js</a></li><li class="sidebar-sub-header"><a href="/documentation/ThreeD/02._ThreeJs.html#loadingcontroller-js" class="sidebar-link">LoadingController.js</a></li><li class="sidebar-sub-header"><a href="/documentation/ThreeD/02._ThreeJs.html#particlesystem-js" class="sidebar-link">ParticleSystem.js</a></li><li class="sidebar-sub-header"><a href="/documentation/ThreeD/02._ThreeJs.html#pillards-js" class="sidebar-link">Pillards.js</a></li><li class="sidebar-sub-header"><a href="/documentation/ThreeD/02._ThreeJs.html#soundreactor-js" class="sidebar-link">SoundReactor.js</a></li><li class="sidebar-sub-header"><a href="/documentation/ThreeD/02._ThreeJs.html#spektrum-js" class="sidebar-link">Spektrum.js</a></li></ul></li><li><a href="/documentation/ThreeD/03._Shaders.html" class="sidebar-link">Shaders</a></li><li><a href="/documentation/ThreeD/04._vue.html" class="sidebar-link">Vue</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="threejs"><a href="#threejs" class="header-anchor">#</a> ThreeJs</h1> <h2 id="mainthreescene-js"><a href="#mainthreescene-js" class="header-anchor">#</a> MainThreeScene.js</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">&quot;three&quot;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> OrbitControls <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/controls/OrbitControls'</span>

<span class="token keyword">import</span> Floor <span class="token keyword">from</span> <span class="token string">'./Floor'</span>
<span class="token keyword">import</span> Pillards <span class="token keyword">from</span> <span class="token string">'./Pillards'</span>
<span class="token keyword">import</span> Spektrum <span class="token keyword">from</span> <span class="token string">'./Spektrum'</span>
<span class="token keyword">import</span> ParticleSystem <span class="token keyword">from</span> <span class="token string">'./ParticleSystem'</span>
<span class="token keyword">import</span> CamParallax <span class="token keyword">from</span> <span class="token string">'./CamParallax'</span>

<span class="token keyword">import</span> <span class="token constant">RAF</span> <span class="token keyword">from</span> <span class="token string">'../utils/RAF'</span>
<span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'../utils/config'</span>
<span class="token keyword">import</span> MyGUI <span class="token keyword">from</span> <span class="token string">'../utils/MyGUI'</span>


<span class="token keyword">class</span> <span class="token class-name">MainThreeScene</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer
        <span class="token keyword">this</span><span class="token punctuation">.</span>controls
    <span class="token punctuation">}</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//RENDERER SETUP</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">antialias</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>debug<span class="token punctuation">.</span>checkShaderErrors <span class="token operator">=</span> <span class="token boolean">true</span>
        container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span>

        <span class="token comment">//MAIN SCENE INSTANCE</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">0x151515</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> fog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Fog</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span>fog <span class="token operator">=</span> fog
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span>background <span class="token operator">=</span> color

        <span class="token comment">//CAMERA AND ORBIT CONTROLLER</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>controls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">.</span>maxDistance <span class="token operator">=</span> <span class="token number">40</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">.</span>minDistance <span class="token operator">=</span> <span class="token number">3</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">.</span>minPolarAngle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">.</span>maxPolarAngle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> 

        <span class="token comment">//Floor</span>
        Floor<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">)</span>

        <span class="token comment">//SpherePillards</span>
        Pillards<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">)</span>

        <span class="token comment">//Spektrum</span>
        Spektrum<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">)</span>
        <span class="token comment">//ParticleSystem</span>
        ParticleSystem<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">)</span>
        <span class="token comment">//CamParallax </span>
        CamParallax<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span>
       

        MyGUI<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>myGui<span class="token punctuation">)</span>
            MyGUI<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">const</span> camFolder <span class="token operator">=</span> MyGUI<span class="token punctuation">.</span><span class="token function">addFolder</span><span class="token punctuation">(</span><span class="token string">&quot;Camera Folder&quot;</span><span class="token punctuation">)</span>
            camFolder<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            camFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">,</span><span class="token string">&quot;enabled&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">.</span>enabled<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                CamParallax<span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">false</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;Orbit Controls&quot;</span><span class="token punctuation">)</span>
            camFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>CamParallax<span class="token punctuation">,</span><span class="token string">&quot;active&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>CamParallax<span class="token punctuation">.</span>active<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">.</span>enabled<span class="token operator">=</span><span class="token boolean">false</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;Cam Parallax&quot;</span><span class="token punctuation">)</span>
            camFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>CamParallax<span class="token punctuation">.</span>params<span class="token punctuation">,</span><span class="token string">&quot;intensity&quot;</span><span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span>
            camFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>CamParallax<span class="token punctuation">.</span>params<span class="token punctuation">,</span><span class="token string">&quot;ease&quot;</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">)</span>
        <span class="token comment">//RENDER LOOP AND WINDOW SIZE UPDATER SETUP</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;resize&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resizeCanvas<span class="token punctuation">)</span>
        <span class="token constant">RAF</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'threeSceneUpdate'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">rotateY</span><span class="token punctuation">(</span><span class="token number">0.0015</span><span class="token punctuation">)</span>
        Pillards<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        Spektrum<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        ParticleSystem<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        CamParallax<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">resizeCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>aspect <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resizeCanvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resizeCanvas</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>update <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MainThreeScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> _instance
</code></pre></div><h2 id="floor-js"><a href="#floor-js" class="header-anchor">#</a> Floor.js</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>GLTFLoader<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/loaders/GLTFLoader'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>
<span class="token keyword">import</span> LoadingController <span class="token keyword">from</span> <span class="token string">&quot;./LoadingController&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">Floor</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>modelLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GLTFLoader</span><span class="token punctuation">(</span>LoadingController<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">scene</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> scene
        <span class="token keyword">this</span><span class="token punctuation">.</span>floor
        <span class="token keyword">this</span><span class="token punctuation">.</span>modelLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./assets/models/Floor.glb'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">glb</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  glb<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>child <span class="token keyword">instanceof</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>floor <span class="token operator">=</span> child
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>floor<span class="token punctuation">.</span><span class="token function">translateY</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>floor<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>floor<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> _instance
</code></pre></div><h2 id="camparallax-js"><a href="#camparallax-js" class="header-anchor">#</a> CamParallax.js</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">CamParallax</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mousePos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">intensity</span><span class="token operator">:</span> <span class="token number">0.008</span><span class="token punctuation">,</span>
            <span class="token literal-property property">ease</span><span class="token operator">:</span> <span class="token number">0.08</span><span class="token punctuation">,</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">camera</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> camera
        <span class="token keyword">this</span><span class="token punctuation">.</span>initZ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onMouseMove<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">onMouseMove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mousePos<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>intensity
        <span class="token keyword">this</span><span class="token punctuation">.</span>mousePos<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> window<span class="token punctuation">.</span>innerHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>intensity
        <span class="token keyword">const</span> yLimit <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3.656</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mousePos<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> yLimit<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>mousePos<span class="token punctuation">.</span>y <span class="token operator">=</span> yLimit<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mousePos<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>ease
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mousePos<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>ease
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>initZ <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>ease
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onMouseMove <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onMouseMove</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CamParallax</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> _instance
</code></pre></div><h2 id="loadingcontroller-js"><a href="#loadingcontroller-js" class="header-anchor">#</a> LoadingController.js</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">&quot;three&quot;</span>

<span class="token keyword">const</span> _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>LoadingManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
_instance<span class="token punctuation">.</span><span class="token function-variable function">onProgress</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> loaded<span class="token punctuation">,</span> total</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> loaded<span class="token punctuation">,</span> total<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> _instance
</code></pre></div><h2 id="particlesystem-js"><a href="#particlesystem-js" class="header-anchor">#</a> ParticleSystem.js</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ParticleSystem</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>particleCount <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>boxSize <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">scene</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> scene
        <span class="token keyword">this</span><span class="token punctuation">.</span>particlesGeom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BufferGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>particlesPos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> p <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>particleCount<span class="token punctuation">;</span> p<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">let</span> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxSize <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxSize <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> z <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxSize <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

            <span class="token comment">// Create the vertex</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>particlesPos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>particlesGeom<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'position'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Float32BufferAttribute</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>particlesPos<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>particleMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointsMaterial</span><span class="token punctuation">(</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xffffff</span><span class="token punctuation">,</span>
                <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">.02</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>particleSystem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Points</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>particlesGeom<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>particleMaterial<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>particlesGeom<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>particleSystem<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>particleCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// this.particlesGeom.attributes.position.array[i * 3 + 0] += 0.01</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>particlesGeom<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">.</span>array<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">0.01</span>
            <span class="token comment">// this.particlesGeom.attributes.position.array[i * 3 + 2] += 0.01</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>particlesGeom<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">.</span>array<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>particlesGeom<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">.</span>array<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxSize <span class="token operator">/</span> <span class="token number">2</span>
            <span class="token punctuation">}</span>
            i<span class="token operator">++</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>particlesGeom<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>update <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">const</span> _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParticleSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> _instance
</code></pre></div><h2 id="pillards-js"><a href="#pillards-js" class="header-anchor">#</a> Pillards.js</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>GLTFLoader<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/loaders/GLTFLoader'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>
<span class="token keyword">import</span> SoundReactor <span class="token keyword">from</span> <span class="token string">'./SoundReactor'</span>

<span class="token keyword">import</span> LoadingController <span class="token keyword">from</span> <span class="token string">&quot;./LoadingController&quot;</span>
<span class="token keyword">import</span> MyGUI <span class="token keyword">from</span> <span class="token string">'../utils/MyGUI'</span>
<span class="token keyword">class</span> <span class="token class-name">Pillards</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>modelLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GLTFLoader</span><span class="token punctuation">(</span>LoadingController<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>texLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span>LoadingController<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">waveSpeed</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">subDiv</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token literal-property property">pillardSize</span><span class="token operator">:</span> <span class="token number">.2</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">scene</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> scene
        <span class="token keyword">this</span><span class="token punctuation">.</span>upVec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> bTex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>texLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./assets/textures/bTex.png'</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> gTex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>texLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./assets/textures/gTex.png'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>gMatCap <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshMatcapMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">matcap</span><span class="token operator">:</span>gTex<span class="token punctuation">}</span><span class="token punctuation">)</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span>bMatCap <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshMatcapMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">matcap</span><span class="token operator">:</span>bTex<span class="token punctuation">}</span><span class="token punctuation">)</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span>pillard
        <span class="token keyword">this</span><span class="token punctuation">.</span>pillards<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>modelLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./assets/models/Pillards.glb'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">glb</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> 
            glb<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;base&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                  <span class="token keyword">this</span><span class="token punctuation">.</span>pillard <span class="token operator">=</span> child
                  child<span class="token punctuation">.</span>material <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>bMatCap
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;Cylinder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    child<span class="token punctuation">.</span>material <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>gMatCap 
                  <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">computerPositions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> sphereFolder <span class="token operator">=</span> MyGUI<span class="token punctuation">.</span><span class="token function">addFolder</span><span class="token punctuation">(</span><span class="token string">'Sphere Pillards'</span><span class="token punctuation">)</span>
        sphereFolder<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        sphereFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">,</span> <span class="token string">&quot;waveSpeed&quot;</span><span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'wave Speed'</span><span class="token punctuation">)</span>
        sphereFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">,</span> <span class="token string">&quot;subDiv&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'Ico Subdivisions'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>computerPositions<span class="token punctuation">)</span>
        sphereFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">,</span> <span class="token string">&quot;pillardSize&quot;</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'Pill Size'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>computerPositions<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">computerPositions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> ico
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'ico'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                ico <span class="token operator">=</span> child
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ico<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>ico<span class="token punctuation">)</span>

        <span class="token keyword">const</span> sphereGeom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>IcosahedronGeometry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>subDiv<span class="token punctuation">)</span>
        <span class="token keyword">const</span> sphereMat <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gMatCap
        <span class="token keyword">const</span> sphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>sphereGeom<span class="token punctuation">,</span>sphereMat<span class="token punctuation">)</span>
        sphere<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ico'</span>
        <span class="token comment">// const sphere = new THREE.Mesh(sphereGeom,new THREE.MeshNormalMaterial({wireframe:true}))</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sphere<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pillards<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> verArray<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>sphereGeom<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">.</span>array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">+=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> x <span class="token operator">=</span> sphereGeom<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">.</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">const</span> y <span class="token operator">=</span> sphereGeom<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">.</span>array<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">const</span> z <span class="token operator">=</span> sphereGeom<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">.</span>array<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>
            verArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">x</span><span class="token operator">:</span>x<span class="token punctuation">,</span>
                <span class="token literal-property property">y</span><span class="token operator">:</span>y<span class="token punctuation">,</span>
                <span class="token literal-property property">z</span><span class="token operator">:</span>z<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> pillPos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>verArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> existsFlag <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>pillPos<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>pillPos<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">==</span> verArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">&amp;&amp;</span> pillPos<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">==</span> verArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&amp;&amp;</span> pillPos<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token operator">==</span> verArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    existsFlag <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>existsFlag<span class="token punctuation">)</span><span class="token punctuation">{</span>
                pillPos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">x</span><span class="token operator">:</span> verArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>
                    <span class="token literal-property property">y</span><span class="token operator">:</span> verArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>
                    <span class="token literal-property property">z</span><span class="token operator">:</span> verArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pillard<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token keyword">const</span> posVec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Vector3</span><span class="token punctuation">(</span>verArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> verArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> verArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                 c<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>posVec<span class="token punctuation">)</span> 
                 c<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>pillardSize<span class="token punctuation">)</span>
                 c<span class="token punctuation">.</span>quaternion<span class="token punctuation">.</span><span class="token function">setFromUnitVectors</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>upVec<span class="token punctuation">,</span>posVec<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
               
               
                <span class="token keyword">this</span><span class="token punctuation">.</span>pillards<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pillards<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>SoundReactor<span class="token punctuation">.</span>playFlag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pillards<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>pillards<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> SoundReactor<span class="token punctuation">.</span>fdata<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">255</span> <span class="token operator">*</span> <span class="token number">4</span>
                i<span class="token operator">++</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pillards<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>pillards<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.01</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>waveSpeed <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pillards<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>position<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.5</span>
                i<span class="token operator">++</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>computerPositions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">computerPositions</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pillards</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> _instance
</code></pre></div><h2 id="soundreactor-js"><a href="#soundreactor-js" class="header-anchor">#</a> SoundReactor.js</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token constant">RAF</span> <span class="token keyword">from</span> <span class="token string">'../utils/RAF'</span>

<span class="token keyword">class</span> <span class="token class-name">SoundReactor</span> <span class="token punctuation">{</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">audioUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx
        <span class="token keyword">this</span><span class="token punctuation">.</span>audio
        <span class="token keyword">this</span><span class="token punctuation">.</span>audioSource
        <span class="token keyword">this</span><span class="token punctuation">.</span>analyser
        <span class="token keyword">this</span><span class="token punctuation">.</span>fdata
        <span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> audioUrl
        <span class="token keyword">this</span><span class="token punctuation">.</span>playFlag <span class="token operator">=</span> <span class="token boolean">false</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Audio</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audioSource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">createMediaElementSource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>analyser <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">createAnalyser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>analyser<span class="token punctuation">.</span>smoothingTimeConstant <span class="token operator">=</span> <span class="token number">0.8</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>audioSource<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>analyser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audioSource<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fdata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>analyser<span class="token punctuation">.</span>frequencyBinCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> <span class="token number">41</span>

    <span class="token punctuation">}</span>

    <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>playFlag <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token constant">RAF</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'audioReactorUpdate'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>update<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>playFlag <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token constant">RAF</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token string">'audioReactorUpdate'</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>analyser<span class="token punctuation">.</span><span class="token function">getByteFrequencyData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>update <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">const</span> _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundReactor</span><span class="token punctuation">(</span><span class="token string">&quot;assets/everything-feels-new-15241.mp3&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> _instance<span class="token punctuation">;</span>
</code></pre></div><h2 id="spektrum-js"><a href="#spektrum-js" class="header-anchor">#</a> Spektrum.js</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>GLTFLoader<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/loaders/GLTFLoader'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>
<span class="token keyword">import</span> LoadingController <span class="token keyword">from</span> <span class="token string">&quot;./LoadingController&quot;</span>
<span class="token keyword">import</span> spektrumFrag <span class="token keyword">from</span> <span class="token string">'../shaders/spektrum.frag'</span>
<span class="token keyword">import</span> spektrumVert <span class="token keyword">from</span> <span class="token string">'../shaders/spektrum.vert'</span>
<span class="token keyword">import</span> MyGUI <span class="token keyword">from</span> <span class="token string">'../utils/MyGUI'</span>

<span class="token keyword">class</span> <span class="token class-name">Spektrum</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>modelLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GLTFLoader</span><span class="token punctuation">(</span>LoadingController<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>texLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span>LoadingController<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">scene</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> scene

        <span class="token keyword">this</span><span class="token punctuation">.</span>uniforms <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">uMatCap</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>texLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'assets/textures/bTex.png'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">uSpecterSize</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token number">0.8</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">uWaveBorder</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token number">0.3</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">uWaveSpeed</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token number">0.1</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">uBorderColor</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token string">&quot;hsl(287,80%,80%)&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">uTime</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token number">0</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> shaderFolder <span class="token operator">=</span> MyGUI<span class="token punctuation">.</span><span class="token function">addFolder</span><span class="token punctuation">(</span><span class="token string">&quot;Spectrum Folder&quot;</span><span class="token punctuation">)</span>
        shaderFolder<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        shaderFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>uSpecterSize<span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;Specter Size&quot;</span><span class="token punctuation">)</span>
        shaderFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>uWaveBorder<span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;Wave Border&quot;</span><span class="token punctuation">)</span>
        shaderFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>uWaveSpeed<span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;Wave Speed&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>shaderMat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>ShaderMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">fragmentShader</span><span class="token operator">:</span>spektrumFrag<span class="token punctuation">,</span>
            <span class="token literal-property property">vertexShader</span><span class="token operator">:</span>spektrumVert<span class="token punctuation">,</span>
            <span class="token literal-property property">uniforms</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>uniforms<span class="token punctuation">,</span>
            <span class="token literal-property property">transparent</span><span class="token operator">:</span><span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>modelLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./assets/models/spektrum.glb'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">glb</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  glb<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>child <span class="token keyword">instanceof</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">)</span>
            child<span class="token punctuation">.</span>material <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shaderMat
            child<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token number">1.7</span><span class="token punctuation">)</span>
            child<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>glb<span class="token punctuation">.</span>scene<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>uTime<span class="token punctuation">.</span>value<span class="token operator">+=</span><span class="token number">1</span>
    <span class="token punctuation">}</span>

    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spektrum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> _instance
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/documentation/ThreeD/01._Blender.html" class="prev">
        Blender
      </a></span> <span class="next"><a href="/documentation/ThreeD/03._Shaders.html">
        Shaders
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/documentation/assets/js/app.278a8878.js" defer></script><script src="/documentation/assets/js/2.02551ac5.js" defer></script><script src="/documentation/assets/js/26.ae923d6f.js" defer></script>
  </body>
</html>
